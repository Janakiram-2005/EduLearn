<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Body Transport Mission</title>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;500;600;700&display=swap" rel="stylesheet">
    <style>
        :root {
            --header-bg: #ffffff; --page-bg: #f4f7f9; --panel-bg: #ffffff;
            --border-color: #e0e0e0; --text-dark: #1e293b; --blood-red-dark: #b71c1c;
            --accent-blue: #3b82f6; --accent-green: #22c55e; --accent-red: #ef4444;
            --primary-blue: #007bff; --secondary-gray: #6c757d;
        }
        body {
            font-family: 'Poppins', sans-serif; background-color: var(--page-bg);
            color: var(--text-dark); margin: 0; height: 100vh; overflow: hidden;
        }
        .page-container { display: flex; flex-direction: column; height: 100vh; }
        .header {
            position: fixed; top: 0; left: 0; width: 100%; height: 60px;
            background-color: var(--header-bg); display: flex; align-items: center; justify-content: space-between;
            padding: 0 24px; border-bottom: 1px solid var(--border-color);
            box-shadow: 0 2px 4px rgba(0,0,0,0.05); z-index: 1000; box-sizing: border-box;
        }
        .header-section { flex: 1; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; }
        .header-section.center { text-align: center; font-size: 1.2em; font-weight: bold; }
        .header-section.right { display: flex; justify-content: flex-end; }
        .button {
            padding: 8px 16px; margin-left: 10px; cursor: pointer;
            border: none; border-radius: 6px; font-weight: 600; color: white;
            white-space: nowrap;
        }
        .main-content {
            margin-top: 60px; padding: 24px; display: flex;
            flex-grow: 1; overflow: hidden; gap: 24px; justify-content: center;
        }
        .panel {
            background-color: var(--panel-bg); border-radius: 12px;
            box-shadow: 0 4px 12px rgba(0,0,0,0.08); border: 1px solid var(--border-color);
            overflow-y: auto; padding: 24px 32px; height: calc(100vh - 108px);
        }
        #info-panel { flex-shrink: 0; transition: width 400ms ease-in-out; }
        #activity-panel { display: none; flex-grow: 1; padding: 0; flex-direction: column; }

        .main-content.activity-visible #info-panel { width: 340px; min-width: 340px; }
        .main-content.activity-visible #activity-panel { display: flex; }

        /* --- GAME STYLES --- */
        #gameArea {
            flex-grow: 1; position: relative;
            background-color: #ff7979;
            background-image: linear-gradient(45deg, #ff5252 25%, transparent 25%), 
                              linear-gradient(-45deg, #ff5252 25%, transparent 25%),
                              linear-gradient(45deg, transparent 75%, #ff5252 75%),
                              linear-gradient(-45deg, transparent 75%, #ff5252 75%);
            background-size: 20px 20px;
            animation: moveBackground 10s linear infinite;
            overflow: hidden; border-radius: 12px 12px 0 0;
            border: 4px solid white;
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
        }
        @keyframes moveBackground { from { background-position: 0 0; } to { background-position: 0 400px; } }
        
        #player {
            position: absolute; bottom: 20px;
            width: 50px; height: 50px;
            background-color: #d32f2f; border-radius: 50%;
            border: 3px solid var(--blood-red-dark);
            box-shadow: inset 0 0 10px rgba(0,0,0,0.4);
            z-index: 10;
        }
        
        .item {
            position: absolute; width: 40px; height: 40px;
            font-size: 1.5em; display: flex; justify-content: center;
            align-items: center; border-radius: 8px;
            color: white; font-weight: 700;
            box-shadow: 0 2px 5px rgba(0,0,0,0.4);
        }
        .good { background-color: var(--accent-green); }
        .waste { background-color: #7e57c2; } /* Purple */

        .bottom-control-bar { height: 60px; display: flex; justify-content: space-between; align-items: center; padding: 0 20px; background-color: var(--page-bg); border-top: 1px solid var(--border-color); flex-shrink: 0; border-radius: 0 0 12px 12px; }
        .status-bar { font-weight: bold; color: var(--text-dark); font-size: 1.1em; display: flex; gap: 1rem; }
        .reset-button { padding: 8px 16px; cursor: pointer; background-color: var(--accent-red); color: white; border: none; border-radius: 6px; font-weight: 600; }
        
        #gameOverScreen {
            position: absolute; top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(0, 0, 0, 0.75); color: white;
            display: none; flex-direction: column;
            justify-content: center; align-items: center;
            text-align: center; z-index: 100;
        }
        #gameOverScreen h2 { font-size: 3em; color: var(--accent-red); margin: 0; }
        #gameOverScreen p { font-size: 1.2em; }
        #gameOverScreen button {
            margin-top: 20px; padding: 15px 35px;
            font-size: 1.5em; font-weight: 700;
            background-color: var(--accent-blue); color: white;
            border: none; border-radius: 12px;
            cursor: pointer;
        }

        .screen-flash-animation { animation: screenFlash 0.3s ease-out; }
        @keyframes screenFlash {
            from { box-shadow: inset 0 0 0 0 rgba(239, 68, 68, 0.8); }
            to { box-shadow: inset 0 0 0 2000px rgba(239, 68, 68, 0); }
        }
    </style>
</head>
<body class="page-container">
    <header class="header">
        <div class="header-section">Grade 8 - Body Systems</div>
        <div class="header-section center" id="header-title">Mission Briefing</div>
        <div class="header-section right">
            <button id="back-btn" class="button" style="background-color: var(--secondary-gray);">Back</button>
            <button id="toggle-view-btn" class="button" style="background-color: var(--primary-blue);">Start Activity</button>
            <button id="difficulty-btn" class="button" style="background-color: var(--accent-blue);">Difficulty: Easy</button>
        </div>
    </header>

    <main class="main-content" id="main-content">
        <section id="info-panel" class="panel">
            <h1>🩸 Body Transport Mission</h1>
            <p>You are a Red Blood Cell! Your important job is to travel through the bloodstream, delivering good things to the body and cleaning up waste.</p>
            <h3>How to Play:</h3>
            <ol>
                <li>Use the <strong>Left and Right Arrow Keys</strong> to move.</li>
                <li>Catch the good molecules <strong>(O₂ and N)</strong> for "Delivered" points.</li>
                <li>You must also catch the <strong>Waste molecules (W)</strong> for "Removed" points.</li>
                <li><strong>IMPORTANT:</strong> If you miss a Waste molecule (W) and it falls off the screen, you will lose health!</li>
            </ol>
            <p>Survive as long as you can and get the highest score!</p>
        </section>

        <section id="activity-panel" class="panel">
            <div id="gameArea">
                <div id="player"></div>
                <div id="gameOverScreen">
                    <h2>Game Over</h2>
                    <p id="finalScoreText"></p>
                    <button id="playAgainButton">Play Again</button>
                </div>
            </div>
            <footer class="bottom-control-bar">
                <div id="status-bar" class="status-bar"></div>
                <button id="reset-btn" class="reset-button">Reset</button>
            </footer>
        </section>
    </main>

    <script>
    document.addEventListener('DOMContentLoaded', () => {
        const mainContent = document.getElementById('main-content');
        const infoPanel = document.getElementById('info-panel');
        const headerTitle = document.getElementById('header-title');
        const toggleViewBtn = document.getElementById('toggle-view-btn');
        const difficultyBtn = document.getElementById('difficulty-btn');
        const backBtn = document.getElementById('back-btn');
        const gameArea = document.getElementById('gameArea');
        const player = document.getElementById('player');
        const statusBar = document.getElementById('status-bar');
        const gameOverScreen = document.getElementById('gameOverScreen');
        const finalScoreText = document.getElementById('finalScoreText');
        const playAgainButton = document.getElementById('playAgainButton');
        const resetBtn = document.getElementById('reset-btn');
        
        const difficultySettings = {
            easy: { speed: 3, interval: 1200, label: "Easy" },
            medium: { speed: 5, interval: 900, label: "Medium" },
            hard: { speed: 7, interval: 600, label: "Hard" }
        };
        const difficulties = ['easy', 'medium', 'hard'];
        let difficultyIndex = 0;

        const itemTypes = [
            { id: 'O₂', type: 'good' }, { id: 'N', type: 'good' }, { id: 'W', type: 'waste' }
        ];

        let scoreDelivered, scoreRemoved, health, gameInterval, isGameOver, showActivity = false;

        function updateLayout() {
            mainContent.classList.toggle('activity-visible', showActivity);
            infoPanel.style.width = showActivity ? '340px' : `${Math.min(700, window.innerWidth - 48)}px`;
            headerTitle.textContent = showActivity ? 'Body Transport Mission' : 'Mission Briefing';
            toggleViewBtn.textContent = showActivity ? 'Mission Briefing' : 'Start Activity';
        }

        function initGame() {
            scoreDelivered = 0; scoreRemoved = 0; health = 3; isGameOver = true;
            updateHUD();
            gameOverScreen.style.display = 'none';
            player.style.left = `${gameArea.offsetWidth / 2 - player.offsetWidth / 2}px`;
            document.querySelectorAll('.item').forEach(item => item.remove());
        }

        function startGame() {
            initGame();
            isGameOver = false;
            const currentDifficulty = difficultySettings[difficulties[difficultyIndex]];
            gameInterval = setInterval(spawnItem, currentDifficulty.interval);
            document.addEventListener('keydown', movePlayer);
        }

        function endGame() {
            isGameOver = true;
            clearInterval(gameInterval);
            document.removeEventListener('keydown', movePlayer);
            finalScoreText.innerHTML = `Delivered: ${scoreDelivered} &nbsp; | &nbsp; Removed: ${scoreRemoved}`;
            gameOverScreen.style.display = 'flex';
        }

        function updateHUD() {
            statusBar.innerHTML = `<span>✅ Delivered: ${scoreDelivered}</span> <span>🗑️ Removed: ${scoreRemoved}</span> <span>❤️ Health: ${health}</span>`;
        }
        
        function movePlayer(e) {
            if (isGameOver) return;
            let playerX = player.offsetLeft;
            if (e.key === 'ArrowLeft') playerX -= 30;
            if (e.key === 'ArrowRight') playerX += 30;
            player.style.left = `${Math.max(0, Math.min(gameArea.offsetWidth - player.offsetWidth, playerX))}px`;
        }

        function spawnItem() {
            if (isGameOver) return;
            const itemData = itemTypes[Math.floor(Math.random() * itemTypes.length)];
            const itemEl = document.createElement('div');
            itemEl.className = `item ${itemData.type}`;
            itemEl.textContent = itemData.id;
            
            itemEl.style.left = `${Math.random() * (gameArea.offsetWidth - 40)}px`;
            itemEl.style.top = '-50px';
            gameArea.appendChild(itemEl);

            let fallInterval = setInterval(() => {
                if (isGameOver) { clearInterval(fallInterval); itemEl.remove(); return; }
                const currentDifficulty = difficultySettings[difficulties[difficultyIndex]];
                itemEl.style.top = `${itemEl.offsetTop + currentDifficulty.speed}px`;

                if (isOverlapping(player.getBoundingClientRect(), itemEl.getBoundingClientRect())) {
                    if (itemData.type === 'good') scoreDelivered++;
                    else if (itemData.type === 'waste') scoreRemoved++;
                    updateHUD();
                    clearInterval(fallInterval); itemEl.remove();
                } 
                else if (itemEl.offsetTop > gameArea.offsetHeight) {
                    if (itemData.type === 'waste') {
                        health--;
                        updateHUD();
                        gameArea.classList.add('screen-flash-animation');
                        setTimeout(() => gameArea.classList.remove('screen-flash-animation'), 300);
                        if (health <= 0) endGame();
                    }
                    clearInterval(fallInterval); itemEl.remove();
                }
            }, 50);
        }

        function isOverlapping(rect1, rect2) {
            return !(rect1.right < rect2.left || rect1.left > rect2.right || rect1.bottom < rect2.top || rect1.top > rect2.bottom);
        }
        
        // --- Event Listeners ---
        toggleViewBtn.addEventListener('click', () => {
            showActivity = !showActivity;
            if (showActivity) {
                setTimeout(startGame, 10); // Timeout to allow layout to settle
            } else {
                if (!isGameOver) endGame();
            }
            updateLayout();
        });

        difficultyBtn.addEventListener('click', () => {
            difficultyIndex = (difficultyIndex + 1) % difficulties.length;
            const newDifficulty = difficulties[difficultyIndex];
            difficultyBtn.textContent = `Difficulty: ${difficultySettings[newDifficulty].label}`;
            if (showActivity) {
                if (!isGameOver) endGame();
                startGame();
            }
        });
        
        backBtn.addEventListener('click', () => {
            if (showActivity) {
                showActivity = false;
                if (!isGameOver) endGame();
                updateLayout();
            } else {
                window.history.back();
            }
        });

        playAgainButton.addEventListener('click', startGame);
        resetBtn.addEventListener('click', () => {
            if(showActivity) {
                if (!isGameOver) endGame();
                startGame();
            }
        });
        
        updateLayout();
        initGame();
    });
    </script>
</body>
</html>